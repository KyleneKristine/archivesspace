<%
  values_for_operator = JSONModel(:boolean_query).schema['properties']['op']['enum'].collect {|v| [I18n.t("advanced_search.operator.#{v}", :default => v), v]}
  values_for_scope = JSONModel(:field_query).schema['properties']['field']['enum'].collect {|v| [I18n.t("search_results.filter.#{v}", :default => v), v]}
%>

<div id="template_advanced_search_row"><!--
  <div class="row-fluid">
    <div class="span2">
      <%= select_tag "op${index}", options_for_select(values_for_operator), :id => nil %>
    </div>
    <div class="span6">
      <%= text_field_tag "v${index}", "", :id => nil %>
    </div>
    <div class="span3">
      <%=select_tag "f${index}", options_for_select(values_for_scope), :id => nil %>
    </div>
    <div class="span1">
      <a href="#" class="btn btn-danger advanced-search-remove-row"><span class="icon icon-trash icon-white"></span></a>
    </div>
  </div>
--></div>

<%= form_tag(url_for(:controller => :search, :action => :advanced_search), :method => :get, :class => "advanced-search") do %>
  <%= hidden_field_tag "advanced", true %>

  <div class="advanced-search-row-container">
    <% advanced_search_queries.each_with_index do |query_data, i| %>
      <% field_index = query_data["i"] %>
      <div class="row-fluid">
        <div class="span2">
          <% if i > 0 %>
            <%= select_tag "op#{field_index}", options_for_select(values_for_operator, query_data["negated"] ? "NOT" : query_data["op"]) %>
          <% end %>
        </div>
        <div class="span6">
          <%= text_field_tag "v#{field_index}", query_data["value"] %>
        </div>
        <div class="span3">
          <%= select_tag "f#{field_index}", options_for_select(values_for_scope, query_data["field"]) %>
        </div>
        <div class="span1">
          <% if i > 0 %>
            <a href="#" class="btn btn-danger advanced-search-remove-row"><span class="icon icon-trash icon-white"></span></a>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="row-fluid">
    <div class="span11">
      <hr />
    </div>
    <div class="span1">
      <a href="#" class="btn btn-success advanced-search-add-row"><span class="icon icon-plus icon-white"></span></a>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span6">
      <%= link_to I18n.t("advanced_search.index_switcher.hide"), { :advanced => nil }, {:class => "search-switcher-hide"} %>
    </div>
      <% if current_page?(root_url) %>
        <div class="span2"></div>
        <div class="span3">
          <button class="btn btn-primary"><%= I18n.t("advanced_search.button_text") %></button>
        </div>
        <div class="span1"></div>
      <% else %>
        <div class="span2">
          <%= link_to I18n.t("advanced_search.reset"), {:controller => :search, :action => :do_search, :advanced => true}, :class => "btn reset-advanced-search pull-right" %>
        </div>
        <div class="span3">
          <button class="btn btn-primary"><%= I18n.t("advanced_search.button_text") %></button>
        </div>
        <div class="span1"></div>
      <% end %>
    </div>
  </div>
  <div class="clearfix"></div>
<% end %>