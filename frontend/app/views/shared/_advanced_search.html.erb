<%
  values_for_operator = JSONModel(:boolean_query).schema['properties']['op']['enum'].collect {|v| [I18n.t("advanced_search.operator.#{v}", :default => v), v]}
  values_for_scope = JSONModel(:field_query).schema['properties']['field']['enum'].collect {|v| [I18n.t("search_results.filter.#{v}", :default => v), v]}
%>

<div id="template_advanced_search_row"><!--
  <div class="row-fluid">
    <div class="span2">
      <%= select_tag "op${index}", options_for_select(values_for_operator), :id => nil %>
    </div>
    <div class="span6">
      <%= text_field_tag "v${index}", "", :id => nil %>
    </div>
    <div class="span3">
      <%=select_tag "f${index}", options_for_select(values_for_scope), :id => nil %>
    </div>
    <div class="span1">
      <button class="btn btn-danger advanced-search-remove-row"><span class="icon icon-trash icon-white"></span></button>
    </div>
  </div>
--></div>

<%= form_tag(url_for(:controller => :search, :action => :advanced_search), :method => :get, :class => "advanced-search") do %>
  <%= hidden_field_tag "advanced", true %>

  <div class="advanced-search-row-container">
    <% advanced_search_fields.each_with_index do |values, i| %>
      <% field_index = values["i"] %>
      <div class="row-fluid">
        <div class="span2">
          <% if i > 0 %>
            <%=select_tag "op#{field_index}", options_for_select(values_for_operator, values["op"]) %>
          <% end %>
        </div>
        <div class="span6">
          <%= text_field_tag "v#{field_index}", values["v"] %>
        </div>
        <div class="span3">
          <%=select_tag "f#{field_index}", options_for_select(values_for_scope, values["f"]) %>
        </div>
        <div class="span1">
          <% if i > 0 %>
            <button class="btn btn-danger advanced-search-remove-row"><span class="icon icon-trash icon-white"></span></button>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="row-fluid">
    <div class="span11">
      <hr />
    </div>
    <div class="span1">
      <button class="btn btn-success advanced-search-add-row"><span class="icon icon-plus icon-white"></span></button>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span6">
      <%= link_to I18n.t("advanced_search.index_switcher.hide"), { :advanced => nil }, {:class => "search-switcher-hide"} %>
    </div>
      <% if current_page?(root_url) %>
        <div class="span3"></div>
        <div class="span3">
          <button class="btn btn-primary"><%= I18n.t("advanced_search.button_text") %></button>
        </div>
      <% else %>
        <div class="span3">
          <%= link_to I18n.t("advanced_search.reset"), {:controller => :search, :action => :do_search, :advanced => true}, :class => "btn reset-advanced-search pull-right" %>
        </div>
        <div class="span3">
          <button class="btn btn-primary"><%= I18n.t("advanced_search.button_text") %></button>
        </div>
      <% end %>
    </div>
  </div>
  <div class="clearfix"></div>
<% end %>