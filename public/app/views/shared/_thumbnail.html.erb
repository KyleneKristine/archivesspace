<%
  def is_an_embeddable_image?(thumbnail)
    AppConfig[:thumbnail_file_format_names].include?(thumbnail['file_format_name']) &&
      thumbnail.fetch('file_uri').start_with?('http')
  end
%>

<% if thumbnail = result.thumbnail %>
  <%
    if defined?(thumbnail_link)
      same_window = true
    else
      thumbnail_link = thumbnail.fetch('file_uri')
      same_window = false
    end
  %>
  <% only_show_images = false unless defined?(only_show_images) %>
  <% caption = thumbnail.fetch('caption', "Thumbnail for #{result.display_string}") %>
  <div class="pui-thumbnail">
    <pre style="display: none"><%= thumbnail.pretty_inspect %></pre>
    <%= link_to thumbnail_link, :target => same_window ? '_self' : '_blank' do %>
      <% if is_an_embeddable_image?(thumbnail) %>
        <%= image_tag thumbnail.fetch('file_uri'), :alt => caption %>
      <% else %>
        <% if only_show_images %>
          <div class="pui-thumbnail-spacer"></div>
        <% else %>
          <%= content_tag(:i, nil, {:title => caption, :class => 'pui-thumbnail-icon fa fa-th'}) %>
        <% end %>
      <% end %>
    <% end %>
    <% if thumbnail.fetch('caption', false) %>
      <div class="pui-thumbnail-caption"><%= thumbnail.fetch('caption') %></div>
    <% end %>
  </div>
<% else %>
  <div class="pui-thumbnail-spacer"></div>
<% end %>